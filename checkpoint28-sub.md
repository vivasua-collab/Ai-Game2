# –ß–µ–∫–ø–æ–∏–Ω—Ç 28-sub: Event Bus (—É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)

**–î–∞—Ç–∞:** 2026-02-28
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à—ë–Ω
**–¶–µ–ª—å:** Event Bus –∫–∞–∫ –≥—Ä–∞–Ω–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–∞ –º–µ–∂–¥—É Engine –∏ Skeleton

---

## üìê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ö–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        BROWSER (–∫–ª–∏–µ–Ω—Ç)                         ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ   Engine (Phaser) - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–≤–µ–Ω—Ç–æ–≤            ‚îÇ
‚îÇ   React UI - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                             ‚Üì HTTP POST /api/game/event
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      EVENT BUS (–≥—Ä–∞–Ω–∏—Ü–∞)                         ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ   ‚úì –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π                            ‚îÇ
‚îÇ   ‚úì –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –≤ –Ω—É–∂–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã                          ‚îÇ
‚îÇ   ‚úì –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞—É–¥–∏—Ç                                        ‚îÇ
‚îÇ   ‚úì –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –∏ –∫–æ–º–∞–Ω–¥                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚Üì                   ‚Üì                   ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Combat       ‚îÇ    ‚îÇ Inventory    ‚îÇ    ‚îÇ Environment  ‚îÇ
‚îÇ Handler      ‚îÇ    ‚îÇ Handler      ‚îÇ    ‚îÇ Handler      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                   ‚îÇ                   ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ TruthSystem  ‚îÇ
                    ‚îÇ (—Å–æ—Å—Ç–æ—è–Ω–∏–µ)  ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
src/lib/game/event-bus/
‚îú‚îÄ‚îÄ index.ts              # –≠–∫—Å–ø–æ—Ä—Ç, —É—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ types.ts              # –¢–∏–ø—ã (EventResult, EventContext, etc)
‚îú‚îÄ‚îÄ processor.ts          # –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä (–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è)
‚îú‚îÄ‚îÄ validator.ts          # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π
‚îú‚îÄ‚îÄ logger.ts             # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îî‚îÄ‚îÄ handlers/
    ‚îú‚îÄ‚îÄ combat.ts         # –ë–æ–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è
    ‚îú‚îÄ‚îÄ inventory.ts      # –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
    ‚îú‚îÄ‚îÄ environment.ts    # –û–∫—Ä—É–∂–µ–Ω–∏–µ
    ‚îî‚îÄ‚îÄ movement.ts       # –î–≤–∏–∂–µ–Ω–∏–µ

src/app/api/game/event/
‚îî‚îÄ‚îÄ route.ts              # API endpoint –¥–ª—è Event Bus
```

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### –≠—Ç–∞–ø 1: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Event Bus
- [x] –°–æ–∑–¥–∞—Ç—å `src/lib/game/event-bus/types.ts`
- [x] –°–æ–∑–¥–∞—Ç—å `src/lib/game/event-bus/processor.ts`
- [x] –°–æ–∑–¥–∞—Ç—å `src/lib/game/event-bus/validator.ts`
- [x] –°–æ–∑–¥–∞—Ç—å `src/lib/game/event-bus/logger.ts`

### –≠—Ç–∞–ø 2: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
- [x] –°–æ–∑–¥–∞—Ç—å `handlers/combat.ts`
- [x] –°–æ–∑–¥–∞—Ç—å `handlers/inventory.ts`
- [x] –°–æ–∑–¥–∞—Ç—å `handlers/environment.ts`
- [x] –°–æ–∑–¥–∞—Ç—å `handlers/movement.ts`

### –≠—Ç–∞–ø 3: API –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [x] –û–±–Ω–æ–≤–∏—Ç—å `/api/game/event/route.ts`
- [x] –°–æ–∑–¥–∞—Ç—å `index.ts` —Å —ç–∫—Å–ø–æ—Ä—Ç–æ–º
- [x] –û–±–Ω–æ–≤–∏—Ç—å `EventBusTest.tsx`

### –≠—Ç–∞–ø 4: –û—á–∏—Å—Ç–∫–∞
- [x] –£–¥–∞–ª–∏—Ç—å `mini-services/event-bus` (–±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω)
- [x] –£–¥–∞–ª–∏—Ç—å `useEventBus.ts` (WebSocket –Ω–µ –Ω—É–∂–µ–Ω)
- [x] –£–±—Ä–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç Caddy

---

## üìã –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–æ–±—ã—Ç–∏—è

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|-----|----------|
| **Combat** | `combat:damage_dealt` | –ù–∞–Ω–µ—Å–µ–Ω–∏–µ —É—Ä–æ–Ω–∞ |
| | `technique:use` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–∏–∫–∏ |
| | `technique:charge_start` | –ù–∞—á–∞–ª–æ –∑–∞—Ä—è–¥–∫–∏ |
| | `technique:charge_cancel` | –û—Ç–º–µ–Ω–∞ –∑–∞—Ä—è–¥–∫–∏ |
| **Inventory** | `inventory:use_item` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞ |
| | `inventory:equip_item` | –≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞ |
| | `item:pickup` | –ü–æ–¥–±–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–∞ |
| **Environment** | `environment:enter` | –í—Ö–æ–¥ –≤ –∑–æ–Ω—É |
| | `environment:leave` | –í—ã—Ö–æ–¥ –∏–∑ –∑–æ–Ω—ã |
| | `environment:interact` | –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ |
| **Movement** | `player:move` | –î–≤–∏–∂–µ–Ω–∏–µ |
| | `player:teleport` | –¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è |

---

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è (–∫–ª–∏–µ–Ω—Ç)

```typescript
import { sendEvent } from '@/lib/game/event-bus';
import { EVENT_TYPES } from '@/lib/game/events/game-events';

// –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ
const result = await sendEvent({
  type: EVENT_TYPES.DAMAGE_DEALT,
  sessionId: '...',
  characterId: '...',
  targetId: 'training_dummy_1',
  targetType: 'training_dummy',
  techniqueId: 'tech_basic_strike',
  targetPosition: { x: 500, y: 300 },
  distance: 100,
  rotation: 0,
});

if (result.success) {
  // –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
  result.commands.forEach(cmd => {
    // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —É—Ä–æ–Ω, —ç—Ñ—Ñ–µ–∫—Ç—ã –∏ —Ç.–¥.
  });
}
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏—è

1. –î–æ–±–∞–≤–∏—Ç—å —Ç–∏–ø –≤ `src/lib/game/events/game-events.ts`
2. –°–æ–∑–¥–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ `src/lib/game/event-bus/handlers/`
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `processor.ts`:
   ```typescript
   handlers.set('new:event_type', handleNewEvent);
   ```

---

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

| –ê—Å–ø–µ–∫—Ç | –î–æ | –ü–æ—Å–ª–µ |
|--------|-----|-------|
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å** | WebSocket + mini-service + Caddy | HTTP API |
| **–ü–æ—Ä—Ç—ã** | 3000, 3003, 81 | 3000 |
| **Latency** | WebSocket: ~5-20ms + gateway | HTTP: ~10-50ms |
| **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** | –°–ª–æ–∂–Ω–æ | –ü—Ä–æ—Å—Ç–æ (registerHandler) |
| **–û—Ç–ª–∞–¥–∫–∞** | WebSocket —Ç—Ä—É–¥–Ω–æ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å | HTTP –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–≥—Ä—É —á–µ—Ä–µ–∑ Preview Panel
2. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "üß™ Event Bus" –≤ header
3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å latency
4. –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

---

*–î–æ–∫—É–º–µ–Ω—Ç –æ–±–Ω–æ–≤–ª—ë–Ω: 2026-02-28*
