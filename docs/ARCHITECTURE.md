# ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Cultivation World Simulator

> ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹ Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸ĞµĞ¹ Phaser 3.
> Ğ’ĞµÑ€ÑĞ¸Ñ: 7 | Ğ“Ğ¾Ğ´: 2026

---

## ğŸ“ ĞĞ±Ñ‰Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           CLIENT (Browser)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    page.tsx (Main Entry)                    â”‚   â”‚
â”‚  â”‚                     Auto-init Session                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                      â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚         â–¼                    â–¼                    â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ PhaserGame  â”‚      â”‚  ChatPanel  â”‚      â”‚ActionButtonsâ”‚        â”‚
â”‚  â”‚   (2D)      â”‚      â”‚   (Chat)    â”‚      â”‚ (Meditation)â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                    â”‚                    â”‚                â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                              â–¼                                      â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                   â”‚  game.store.ts  â”‚  â† Zustand State             â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ HTTP
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SERVER (Next.js API)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚/api/game/   â”‚  â”‚/api/chat    â”‚  â”‚/api/        â”‚                 â”‚
â”‚  â”‚start        â”‚  â”‚             â”‚  â”‚meditation   â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚         â”‚                â”‚                â”‚                         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                          â–¼                                          â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚                   â”‚  Services   â”‚                                   â”‚
â”‚                   â”‚  + LLM      â”‚                                   â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                          â–¼                                          â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚                   â”‚   Prisma    â”‚                                   â”‚
â”‚                   â”‚   (SQLite)  â”‚                                   â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° (ĞĞ¾Ğ²Ğ¾Ğµ!)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Page Load                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Check localStorage (session ID)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Session Found     â”‚         â”‚   No Session        â”‚
â”‚                     â”‚         â”‚                     â”‚
â”‚   loadGame(id)      â”‚         â”‚   startGame(1)      â”‚
â”‚         â”‚           â”‚         â”‚   (variant 1: sect) â”‚
â”‚         â–¼           â”‚         â”‚         â”‚           â”‚
â”‚   Validate Session  â”‚         â”‚         â–¼           â”‚
â”‚         â”‚           â”‚         â”‚   Create Character  â”‚
â”‚         â–¼           â”‚         â”‚   Create Session    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”     â”‚         â”‚   Create Location   â”‚
â”‚   â–¼           â–¼     â”‚         â”‚   Create NPCs       â”‚
â”‚ Valid      Invalid  â”‚         â”‚   Create Techniques â”‚
â”‚   â”‚           â”‚     â”‚         â”‚         â”‚           â”‚
â”‚   â–¼           â””â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â–¼           â”‚
â”‚ 2D Mode           New Game   â”‚   Save session ID    â”‚
â”‚                           â”‚   â”‚   to localStorage    â”‚
â”‚                           â”‚   â”‚         â”‚           â”‚
â”‚                           â””â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   2D Mode Active    â”‚
                              â”‚   - PhaserGame      â”‚
                              â”‚   - ChatPanel       â”‚
                              â”‚   - ActionButtons   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹

### `/src/app/` - Next.js App Router

| Ğ¤Ğ°Ğ¹Ğ» | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|------|------------|
| `page.tsx` | Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°, Ğ°Ğ²Ñ‚Ğ¾Ğ·Ğ°Ğ¿ÑƒÑĞº Ğ¸Ğ³Ñ€Ñ‹ |
| `layout.tsx` | ĞšĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ layout |
| `api/game/start/route.ts` | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ğ¸Ğ³Ñ€Ñ‹ |
| `api/game/state/route.ts` | ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ |
| `api/meditation/route.ts` | ĞœĞµĞ´Ğ¸Ñ‚Ğ°Ñ†Ğ¸Ñ (Ğ±ĞµĞ· LLM) |
| `api/chat/route.ts` | Ğ§Ğ°Ñ‚ Ñ LLM |

### `/src/components/game/` - Ğ˜Ğ³Ñ€Ğ¾Ğ²Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹

| Ğ¤Ğ°Ğ¹Ğ» | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|------|------------|
| `PhaserGame.tsx` | 2D Ğ¸Ğ³Ñ€Ğ° Ğ½Ğ° Phaser 3 |
| `ChatPanel.tsx` | Ğ§Ğ°Ñ‚ + ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ±Ğ°Ñ€ |
| `MeditationDialog.tsx` | UI Ğ¼ĞµĞ´Ğ¸Ñ‚Ğ°Ñ†Ğ¸Ğ¸ (ÑĞ»Ğ°Ğ¹Ğ´ĞµÑ€, Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·) |
| `ActionButtons.tsx` | ĞšĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ñ… Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹ |

### `/src/lib/game/` - Ğ˜Ğ³Ñ€Ğ¾Ğ²Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°

| Ğ¤Ğ°Ğ¹Ğ» | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|------|------------|
| `constants.ts` | Ğ’ÑĞµ ĞºĞ¾Ğ½ÑÑ‚Ğ°Ğ½Ñ‚Ñ‹ Ğ¸Ğ³Ñ€Ñ‹ |
| `qi-system.ts` | ĞœĞµĞ´Ğ¸Ñ‚Ğ°Ñ†Ğ¸Ñ, Ğ¿Ñ€Ğ¾Ñ€Ñ‹Ğ² (ÑĞµÑ€Ğ²ĞµÑ€) |
| `qi-shared.ts` | Ğ Ğ°ÑÑ‡Ñ‘Ñ‚Ñ‹ Ğ¦Ğ¸ (ĞºĞ»Ğ¸ĞµĞ½Ñ‚/ÑĞµÑ€Ğ²ĞµÑ€) |
| `fatigue-system.ts` | Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑƒÑÑ‚Ğ°Ğ»Ğ¾ÑÑ‚Ğ¸ |
| `techniques.ts` | ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ¸ |
| `world-coordinates.ts` | 3D ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ‚Ñ‹ Ğ¼Ğ¸Ñ€Ğ° |

### `/src/stores/` - Zustand Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğ°

| Ğ¤Ğ°Ğ¹Ğ» | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|------|------------|
| `game.store.ts` | Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¸Ğ³Ñ€Ñ‹ |

**Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼Ñ‹Ğµ ÑĞµĞ»ĞµĞºÑ‚Ğ¾Ñ€Ñ‹:**
- `useGameCharacter()` - Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ°
- `useGameLocation()` - Ñ‚ĞµĞºÑƒÑ‰Ğ°Ñ Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ñ
- `useGameMessages()` - ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ñ‡Ğ°Ñ‚Ğ°
- `useGameLoading()` - ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸
- `useGameActions()` - Ğ²ÑĞµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ (loadState, startGame, etc.)

---

## ğŸ® Phaser 3 Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ

### ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ

```typescript
const config: Phaser.Types.Core.GameConfig = {
  type: Phaser.AUTO,           // WebGL Ğ¸Ğ»Ğ¸ Canvas
  width: 900,
  height: 550,
  physics: {
    default: 'arcade',         // Ğ›Ñ‘Ğ³ĞºĞ°Ñ 2D Ñ„Ğ¸Ğ·Ğ¸ĞºĞ°
    arcade: { gravity: { x: 0, y: 0 } }
  },
  scene: [GameSceneConfig],
  scale: {
    mode: Phaser.Scale.FIT,
    autoCenter: Phaser.Scale.CENTER_BOTH
  }
};
```

### SSR ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ

```typescript
// Ğ”Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ² useEffect
useEffect(() => {
  const initGame = async () => {
    const Phaser = (await import('phaser')).default;
    new Phaser.Game(config);
  };
  initGame();
}, []);
```

### Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ñ‚ĞµĞºÑÑ‚ÑƒÑ€ (Ğ±ĞµĞ· Ğ°ÑÑĞµÑ‚Ğ¾Ğ²)

```typescript
// Ğ¢ĞµĞºÑÑ‚ÑƒÑ€Ñ‹ ÑĞ¾Ğ·Ğ´Ğ°ÑÑ‚ÑÑ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ½Ğ¾
const graphics = this.make.graphics();
graphics.fillStyle(0x4ade80);
graphics.fillCircle(24, 24, 24);
graphics.generateTexture('player', 48, 48);
```

ğŸ“– **ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾ÑÑ‚Ğ¸:** [docs/PHASER_STACK.md](./PHASER_STACK.md)

---

## ğŸ”Œ API Ğ­Ğ½Ğ´Ğ¿Ğ¾Ğ¸Ğ½Ñ‚Ñ‹

### Ğ˜Ğ³Ñ€Ğ¾Ğ²Ñ‹Ğµ

| Ğ­Ğ½Ğ´Ğ¿Ğ¾Ğ¸Ğ½Ñ‚ | ĞœĞµÑ‚Ğ¾Ğ´ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|----------|-------|----------|
| `/api/game/start` | POST | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²ÑƒÑ Ğ¸Ğ³Ñ€Ñƒ |
| `/api/game/state` | GET | ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ |
| `/api/game/save` | POST | Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¸Ğ³Ñ€Ñƒ |
| `/api/meditation` | POST | ĞœĞµĞ´Ğ¸Ñ‚Ğ°Ñ†Ğ¸Ñ (Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚ Ğ¦Ğ¸) |
| `/api/chat` | POST | Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ + LLM Ğ¾Ñ‚Ğ²ĞµÑ‚ |

### Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ

| Ğ­Ğ½Ğ´Ğ¿Ğ¾Ğ¸Ğ½Ñ‚ | ĞœĞµÑ‚Ğ¾Ğ´ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|----------|-------|----------|
| `/api/database/migrate` | GET/POST | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ/Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ‘Ğ” |
| `/api/llm/status` | GET | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ LLM Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ¾Ğ² |
| `/api/settings/llm` | GET/POST | ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ LLM |

---

## ğŸ§© ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñ‹ Ğ´Ğ¸Ğ·Ğ°Ğ¹Ğ½Ğ°

### 1. Ğ¡ĞµÑ€Ğ²ĞµÑ€ â€” Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ¸ÑÑ‚Ğ¸Ğ½Ñ‹

```typescript
// âŒ ĞĞ•ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ
const newQi = character.currentQi + gain;

// âœ… ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ
const response = await fetch('/api/meditation', { ... });
setCharacter(response.character);
```

### 2. ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

```typescript
// page.tsx - Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚ Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ
useEffect(() => {
  const savedSessionId = localStorage.getItem(SESSION_KEY);
  if (savedSessionId) {
    loadGame(savedSessionId);
  } else {
    startGame(1); // variant 1: sect
  }
}, []);
```

### 3. Ğ Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸

```
page.tsx â†’ UI Layout only
stores/   â†’ State management
services/ â†’ Business logic
lib/game/ â†’ Calculations
api/      â†’ HTTP layer
```

---

## ğŸ“Š Ğ”Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²

```
page.tsx
    â”‚
    â”œâ”€â”€ PhaserGame.tsx
    â”‚       â”‚
    â”‚       â””â”€â”€ Phaser 3 (dynamic import)
    â”‚               â”‚
    â”‚               â”œâ”€â”€ GameScene (movement)
    â”‚               â”œâ”€â”€ Minimap
    â”‚               â””â”€â”€ UI Overlay
    â”‚
    â”œâ”€â”€ ChatPanel.tsx
    â”‚       â”‚
    â”‚       â”œâ”€â”€ CompactStatusBar
    â”‚       â”œâ”€â”€ MessageList
    â”‚       â””â”€â”€ InputField
    â”‚
    â””â”€â”€ ActionButtons.tsx
            â”‚
            â””â”€â”€ MeditationDialog.tsx
                    â”‚
                    â”œâ”€â”€ TimeSlider
                    â”œâ”€â”€ QiPrediction
                    â””â”€â”€ API call â†’ /api/meditation
```

---

## ğŸš€ Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

### Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ

1. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ² `ActionButtons.tsx`
2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³ Ğ² `components/game/NewDialog.tsx`
3. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ API ÑĞ½Ğ´Ğ¿Ğ¾Ğ¸Ğ½Ñ‚ ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶ĞµĞ½ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚

### Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ ÑÑ†ĞµĞ½Ñ‹ Phaser

1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ ÑÑ†ĞµĞ½Ñ‹ Ğ² `PhaserGame.tsx`
2. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² Ğ¼Ğ°ÑÑĞ¸Ğ² ÑÑ†ĞµĞ½: `scene: [GameScene, NewScene]`

### Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ API

1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ `src/app/api/new-action/route.ts`
2. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Zod Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ
3. Ğ’ĞµÑ€Ğ½ÑƒÑ‚ÑŒ `character` Ğ´Ğ»Ñ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

---

*ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ° Ğ´Ğ»Ñ Ğ²ĞµÑ€ÑĞ¸Ğ¸ 7 (2026-02-26)*
