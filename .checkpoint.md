# üìç CHECKPOINT: –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞–±–æ—Ç—ã

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-02-25
**–í–µ—Ç–∫–∞ Git:** main
**–ü–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç:** a0ad87a - "fix: correct request routing and time advancement"

---

## ‚ö° –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø

### –¢–µ–∫—É—â–∞—è –∑–∞–¥–∞—á–∞
**Phase 2 Architecture - –í—Å–µ –∑–∞–¥–∞—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã** - ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –í—ã—Å–æ–∫–∏–π
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –í—Å–µ –∑–∞–¥–∞—á–∏ Phase 2 –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–∑—Ä–µ–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞

### Dev —Å–µ—Ä–≤–µ—Ä
- **–ü–æ—Ä—Ç:** 3000
- **–°—Ç–∞—Ç—É—Å:** ‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- **LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä:** Z-AI (glm-4-plus)

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **–§–∞–π–ª:** db/custom.db
- **–í–µ—Ä—Å–∏—è —Å—Ö–µ–º—ã:** 6
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω–∞

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏

### –ó–∞–¥–∞—á–∞ 2: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ qi-system/qi-shared
- –£–¥–∞–ª–µ–Ω—ã re-exports –∏–∑ qi-system.ts (—Å—Ç—Ä–æ–∫–∏ 132-142)
- –û–±–Ω–æ–≤–ª—ë–Ω JSDoc —Å —á—ë—Ç–∫–∏–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –º–æ–¥—É–ª—è
- qi-system.ts —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ 2 —Ñ—É–Ω–∫—Ü–∏–∏: performMeditation, attemptBreakthrough

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ–∑—Ä–µ–Ω–∏—è (qi-insight)
- **technique-pool.service.ts:** –ü—Ä–∏ –∏–∑—É—á–µ–Ω–∏–∏ —Ç–µ—Ö–Ω–∏–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è addQiUnderstanding()
- **chat/route.ts:** –ü—Ä–∏ –ø—Ä–æ—Ä—ã–≤–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è qiUnderstandingCap
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ –ø–æ–Ω–∏–º–∞–Ω–∏—è –¶–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è
- –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ cap –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ç–µ—Ö–Ω–∏–∫–∞ –ø—Ä–æ–∑—Ä–µ–Ω–∏—è

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –û–±–Ω–æ–≤–ª—ë–Ω PHASE2-PROGRESS.md (–∑–∞–¥–∞—á–∞ 2 + –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è qi-insight)
- –û–±–Ω–æ–≤–ª—ë–Ω PHASE2-ARCHITECTURE-TODO.md (–≤—Å–µ –∑–∞–¥–∞—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã)
- –°–æ–∑–¥–∞–Ω LOCAL-ADVENTURE-GENERATOR.md (–∫–æ–Ω—Ü–µ–ø—Ü–∏—è)

---

## üìä –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

### –õ–û–ö–ê–õ–¨–ù–û (–±–µ–∑ LLM):
| –¢–∏–ø –∑–∞–ø—Ä–æ—Å–∞ | –ü–∞—Ç—Ç–µ—Ä–Ω | –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö |
|-------------|---------|-----------------|
| `status` | "—Å—Ç–∞—Ç—É—Å", "status" | –ë–î –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ |
| `techniques` | "—Ç–µ—Ö–Ω–∏–∫–∏", "skills" | –ë–î —Ç–µ—Ö–Ω–∏–∫ |
| `inventory` | "–∏–Ω–≤–µ–Ω—Ç–∞—Ä—å" | –ë–î –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è |
| `stats` | "—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏" | –ë–î –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ |
| `location_info` | "–≥–¥–µ —è", "–ª–æ–∫–∞—Ü–∏—è" | –ë–î –ª–æ–∫–∞—Ü–∏–∏ |
| `cultivation` | "–º–µ–¥–∏—Ç–∏—Ä", "–ø—Ä–æ—Ä—ã–≤" | –†–∞—Å—á—ë—Ç—ã –¶–∏ –ª–æ–∫–∞–ª—å–Ω–æ |

### –ì–ò–ë–†–ò–î (–ª–æ–∫–∞–ª—å–Ω—ã–µ —Ä–∞—Å—á—ë—Ç—ã + LLM –æ–ø–∏—Å–∞–Ω–∏–µ):
| –¢–∏–ø –∑–∞–ø—Ä–æ—Å–∞ | –ü–∞—Ç—Ç–µ—Ä–Ω | –ú–µ—Ö–∞–Ω–∏–∫–∞ |
|-------------|---------|----------|
| `cultivation` (–ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ) | –ø—Ä–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–∏ –º–µ–¥–∏—Ç–∞—Ü–∏–∏ | LLM –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ |
| `combat` | "–∞—Ç–∞–∫", "–±–æ–π" | –†–∞—Å—á—ë—Ç—ã —É—Ä–æ–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ + LLM –æ–ø–∏—Å–∞–Ω–∏–µ |

### –ß–ï–†–ï–ó LLM:
| –¢–∏–ø –∑–∞–ø—Ä–æ—Å–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------------|----------|
| `narration` | –ü–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) |
| `dialogue` | –î–∏–∞–ª–æ–≥–∏ —Å NPC |
| `action` | –î–µ–π—Å—Ç–≤–∏—è (!! –∏ -- –ø—Ä–µ—Ñ–∏–∫—Å—ã) |
| `exploration` | –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –º–∏—Ä–∞ |
| `creation` | –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ |

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—ç—Ç–∞ —Å–µ—Å—Å–∏—è)

### BUG #20: –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –≤ —Ä–æ—É—Ç–∏–Ω–≥–µ cultivation
**–ü—Ä–æ–±–ª–µ–º–∞:** `request-router.ts` –≤–æ–∑–≤—Ä–∞—â–∞–ª `useLLM: true` –¥–ª—è cultivation, –Ω–æ `chat/route.ts` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª –µ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**
1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `routeRequest()` - —Ç–µ–ø–µ—Ä—å `useLLM: false` –¥–ª—è cultivation
2. –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è—Ö –º–µ–¥–∏—Ç–∞—Ü–∏–∏ (LLM –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–∞–º)

**–§–∞–π–ª—ã:**
- `src/lib/game/request-router.ts`

### BUG #19: –í—Ä–µ–º—è –Ω–µ –∏–¥—ë—Ç –ø—Ä–∏ –¥–µ–π—Å—Ç–≤–∏—è—Ö
**–ü—Ä–æ–±–ª–µ–º–∞:** LLM —á–∞—Å—Ç–æ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–ª `timeAdvance`, –≤—Ä–µ–º—è —Å—Ç–æ—è–ª–æ

**–†–µ—à–µ–Ω–∏–µ:**
1. –û–±–Ω–æ–≤–ª—ë–Ω –ø—Ä–æ–º–ø—Ç `output-format.md` - `timeAdvance` —Ç–µ–ø–µ—Ä—å –û–ë–Ø–ó–ê–¢–ï–õ–ï–ù
2. –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ –≤—Ä–µ–º—è (5 –º–∏–Ω) –≤ `chat/route.ts` –µ—Å–ª–∏ LLM –Ω–µ –≤–µ—Ä–Ω—É–ª

**–§–∞–π–ª—ã:**
- `src/prompts/templates/system/output-format.md`
- `src/app/api/chat/route.ts`

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∏ (—ç—Ç–∞ —Å–µ—Å—Å–∏—è)

### –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –¶–∏ - ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —è–¥—Ä–æ–º:** `coreCapacity * 0.1 / 86400` –¶–∏/—Å–µ–∫ (10% –≤ —Å—É—Ç–∫–∏)
- **–ü–æ–≥–ª–æ—â–µ–Ω–∏–µ —Å—Ä–µ–¥—ã:** `qiDensity * conductivity * levelMult / 86400` –¶–∏/—Å–µ–∫
- **–ü–∞—Å—Å–∏–≤–Ω—ã–π –∫–∞–ø:** 90% –æ—Ç —ë–º–∫–æ—Å—Ç–∏ —è–¥—Ä–∞
- **–ü—Ä–æ—Ä—ã–≤:** `requiredFills = level * 10 + subLevel`

### UI –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ - ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
- –¶–∏: `currentQi / coreCapacity`
- –ü—Ä–æ—Ä—ã–≤: `accumulatedQi / (coreCapacity * requiredFills)`

---

## üìÅ –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|-----------|
| `src/lib/game/qi-system.ts` | –£–¥–∞–ª–µ–Ω—ã re-exports, –æ–±–Ω–æ–≤–ª—ë–Ω JSDoc |
| `src/services/technique-pool.service.ts` | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è qi-insight |
| `src/app/api/chat/route.ts` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ cap –ø—Ä–∏ –ø—Ä–æ—Ä—ã–≤–µ |
| `docs/PHASE2-PROGRESS.md` | –ó–∞–¥–∞—á–∞ 2 + –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è qi-insight |
| `docs/PHASE2-ARCHITECTURE-TODO.md` | –í—Å–µ –∑–∞–¥–∞—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã |
| `docs/LOCAL-ADVENTURE-GENERATOR.md` | –ù–æ–≤–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è |

---

## üîó –í–∞–∂–Ω—ã–µ —Å—Å—ã–ª–∫–∏

| –î–æ–∫—É–º–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|----------|------------|
| [.session-context](./.session-context) | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏ |
| [docs/PHASE2-ARCHITECTURE-TODO.md](./docs/PHASE2-ARCHITECTURE-TODO.md) | –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –∑–∞–¥–∞—á |
| [docs/PHASE2-PROGRESS.md](./docs/PHASE2-PROGRESS.md) | –ü—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è |

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —Å–µ—Å—Å–∏–∏

| –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å | –ó–Ω–∞—á–µ–Ω–∏–µ |
|------------|----------|
| –ù–∞—á–∞–ª–æ —Å–µ—Å—Å–∏–∏ | 2026-02-25 |
| –í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–¥–∞—á Phase 2 | 7/7 (100%) |
| –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –º–æ–¥—É–ª–µ–π | 1 (qi-insight) |
| –°–æ–∑–¥–∞–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ | 1 |
| –ö–æ–º–º–∏—Ç–æ–≤ | 0 (–æ–∂–∏–¥–∞–µ—Ç—Å—è) |

---

*–≠—Ç–æ—Ç —Ñ–∞–π–ª –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ —Ä–∞–±–æ—Ç—ã.*
