# Phase 2: Architecture ‚Äî –ü—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–ù–∞—á–∞–ª–æ:** 2026-02-24
**–°—Ç–∞—Ç—É—Å:** üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ
**–ó–∞–¥–∞—á–∏:** 1 (—É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–∏–ø–æ–≤) + 3 (Zod –≤–∞–ª–∏–¥–∞—Ü–∏—è)

---

## üì¶ –ó–∞–¥–∞—á–∞ 1: –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–∏–ø–æ–≤ (game-shared.ts)

### –®–∞–≥ 1.1: –ê–Ω–∞–ª–∏–∑ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è —Ç–∏–ø–æ–≤

**–°—Ç–∞—Ç—É—Å:** üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ
**–í—Ä–µ–º—è:** 2026-02-24

#### –ü–æ–∏—Å–∫ LocationData:

**–ù–∞–π–¥–µ–Ω–æ 5 –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–π:**
1. `request-router.ts` ‚Äî name, qiDensity, qiFlowRate?, distanceFromCenter?, terrainType?
2. `environment-system.ts` ‚Äî qiDensity, qiFlowRate, distanceFromCenter, terrainType?
3. `qi-shared.ts` ‚Äî —Ç–æ–ª—å–∫–æ qiDensity (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π)
4. `meditation-interruption.ts` ‚Äî name, terrainType?, qiDensity, distanceFromCenter
5. `qi-system.ts` ‚Äî qiDensity, distanceFromCenter, terrainType?

### –®–∞–≥ 1.2: –°–æ–∑–¥–∞–Ω–∏–µ src/types/game-shared.ts

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
**–í—Ä–µ–º—è:** 2026-02-24

**–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª:** `src/types/game-shared.ts`
- –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `LocationData` –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –î–æ–±–∞–≤–ª–µ–Ω—ã `CharacterQiData`, `QiRatesData` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –®–∞–≥ 1.3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–æ–≤

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
**–í—Ä–µ–º—è:** 2026-02-24

**–û–±–Ω–æ–≤–ª–µ–Ω—ã —Ñ–∞–π–ª—ã:**
1. `src/lib/game/qi-shared.ts` ‚Äî –∏–º–ø–æ—Ä—Ç –∏–∑ game-shared.ts
2. `src/lib/game/qi-system.ts` ‚Äî –∏–º–ø–æ—Ä—Ç –∏–∑ game-shared.ts
3. `src/lib/game/request-router.ts` ‚Äî –∏–º–ø–æ—Ä—Ç –∏–∑ game-shared.ts
4. `src/lib/game/meditation-interruption.ts` ‚Äî –∏–º–ø–æ—Ä—Ç –∏–∑ game-shared.ts
5. `src/lib/game/environment-system.ts` ‚Äî –∏–º–ø–æ—Ä—Ç –∏–∑ game-shared.ts

### –®–∞–≥ 1.4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∫–∏

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
**–í—Ä–µ–º—è:** 2026-02-24

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- `bun run lint` ‚Äî ‚úÖ 0 –æ—à–∏–±–æ–∫
- `npx tsc --noEmit` ‚Äî ‚úÖ 0 –æ—à–∏–±–æ–∫
- –ü–æ–∏—Å–∫ `interface LocationData` ‚Äî ‚úÖ –¢–æ–ª—å–∫–æ –≤ game-shared.ts

### ‚úÖ –ó–∞–¥–∞—á–∞ 1 –ó–ê–í–ï–†–®–ï–ù–ê

**–ú–µ—Ç—Ä–∏–∫–∏:**
- –î–æ: 5 –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–π LocationData
- –ü–æ—Å–ª–µ: 1 —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

---

## üì¶ –ó–∞–¥–∞—á–∞ 3: Zod –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö API

### –®–∞–≥ 3.1: –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–°—Ç–∞—Ç—É—Å:** üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ
**–í—Ä–µ–º—è:** 2026-02-24

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ö–µ–º:

**–£–∂–µ –∏–º–µ—é—Ç Zod –≤–∞–ª–∏–¥–∞—Ü–∏—é:**
1. ‚úÖ `/api/chat` ‚Äî `sendMessageSchema`
2. ‚úÖ `/api/game/start` ‚Äî `startGameSchema`
3. ‚úÖ `/api/game/save` ‚Äî `saveGameSchema`
4. ‚úÖ `/api/game/state` ‚Äî `loadGameSchema`
5. ‚úÖ `/api/settings/llm` ‚Äî `llmSettingsSchema`

**–¢—Ä–µ–±—É—é—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è Zod –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**
1. ‚ùå `/api/cheats` ‚Äî POST { command, characterId, params }
2. ‚ùå `/api/inventory` ‚Äî GET/POST
3. ‚ùå `/api/inventory/use` ‚Äî POST
4. ‚ùå `/api/techniques/pool` ‚Äî GET/POST/PUT
5. ‚ùå `/api/database/migrate` ‚Äî POST
6. ‚ùå `/api/database/reset` ‚Äî POST (–±–µ–∑ body)
7. ‚ùå `/api/logs` ‚Äî GET/POST/DELETE
8. ‚ùå `/api/character/data` ‚Äî GET

### –®–∞–≥ 3.2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Zod —Å—Ö–µ–º –≤ validations/game.ts

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
**–í—Ä–µ–º—è:** 2026-02-24

**–î–æ–±–∞–≤–ª–µ–Ω—ã —Å—Ö–µ–º—ã:**
1. `cheatRequestSchema` ‚Äî –¥–ª—è `/api/cheats`
2. `inventoryQuerySchema`, `inventoryAddSchema`, `inventoryUseSchema` ‚Äî –¥–ª—è `/api/inventory`
3. `techniquePoolQuerySchema`, `techniquePoolGenerateSchema`, `techniquePoolActionSchema` ‚Äî –¥–ª—è `/api/techniques/pool`
4. `databaseMigrateSchema` ‚Äî –¥–ª—è `/api/database/migrate`
5. `logsQuerySchema`, `logsActionSchema`, `logsDeleteSchema` ‚Äî –¥–ª—è `/api/logs`
6. `characterDataQuerySchema` ‚Äî –¥–ª—è `/api/character/data`

### –®–∞–≥ 3.3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ API routes

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
**–í—Ä–µ–º—è:** 2026-02-24

**–û–±–Ω–æ–≤–ª–µ–Ω—ã —Ñ–∞–π–ª—ã:**
1. `/api/cheats/route.ts` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ Zod –≤–∞–ª–∏–¥–∞—Ü–∏—è POST
2. `/api/inventory/route.ts` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è GET –∏ POST
3. `/api/inventory/use/route.ts` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è POST
4. `/api/techniques/pool/route.ts` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è GET, POST, PUT
5. `/api/database/migrate/route.ts` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è POST
6. `/api/logs/route.ts` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è GET, POST, DELETE
7. `/api/character/data/route.ts` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è GET

### –®–∞–≥ 3.4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∫–∏

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
**–í—Ä–µ–º—è:** 2026-02-24

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- `bun run lint` ‚Äî ‚úÖ 0 –æ—à–∏–±–æ–∫
- `npx tsc --noEmit` ‚Äî ‚úÖ 0 –æ—à–∏–±–æ–∫

### ‚úÖ –ó–∞–¥–∞—á–∞ 3 –ó–ê–í–ï–†–®–ï–ù–ê

**–ú–µ—Ç—Ä–∏–∫–∏:**
- –î–æ: 5/13 API routes —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π (38%)
- –ü–æ—Å–ª–µ: 13/13 API routes —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π (100%)

---

## üìä –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç Phase 2

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:
1. **–ó–∞–¥–∞—á–∞ 1: –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–∏–ø–æ–≤** ‚Äî ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
   - –°–æ–∑–¥–∞–Ω `src/types/game-shared.ts`
   - –£—Å—Ç—Ä–∞–Ω–µ–Ω–æ 5 –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–π `LocationData`
   - –û–±–Ω–æ–≤–ª–µ–Ω—ã 5 —Ñ–∞–π–ª–æ–≤ —Å –∏–º–ø–æ—Ä—Ç–∞–º–∏

3. **–ó–∞–¥–∞—á–∞ 3: Zod –≤–∞–ª–∏–¥–∞—Ü–∏—è** ‚Äî ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
   - –î–æ–±–∞–≤–ª–µ–Ω–æ 13 –Ω–æ–≤—ã—Ö Zod —Å—Ö–µ–º
   - –û–±–Ω–æ–≤–ª–µ–Ω–æ 7 API routes
   - 100% –ø–æ–∫—Ä—ã—Ç–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π

### ‚è∏Ô∏è –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:
- –ó–∞–¥–∞—á–∞ 2: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ qi-system/qi-shared
- –ó–∞–¥–∞—á–∞ 4: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ request-router

### –§–∏–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:
- `bun run lint` ‚Äî ‚úÖ PASSED
- `npx tsc --noEmit` ‚Äî ‚úÖ PASSED

---
*–ó–∞–≤–µ—Ä—à–µ–Ω–æ: 2026-02-24*

---

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω–æ–π –ø—Ä–æ–±–ª–µ–º—ã: Google Fonts

**–î–∞—Ç–∞:** 2026-02-24
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–π
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

#### –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ `next/font/google` (Geist/Geist_Mono), —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –ø–∞–¥–µ–Ω–∏—é `next build` –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Google Fonts. –≠—Ç–æ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç —Ü–µ–ª–∏ –æ—Ñ—Ñ–ª–∞–π–Ω-—Ä–∞–±–æ—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞.

#### –†–µ—à–µ–Ω–∏–µ
1. –£–¥–∞–ª—ë–Ω –∏–º–ø–æ—Ä—Ç `next/font/google` –∏–∑ `layout.tsx`
2. –ó–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —à—Ä–∏—Ñ—Ç—ã –≤ `globals.css`:
   - Sans: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto...
   - Mono: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas...

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
- ‚úÖ –°–±–æ—Ä–∫–∞ –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ –†–∞–±–æ—Ç–∞ –≤ –æ—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–µ
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (–Ω–µ—Ç —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
- ‚úÖ –ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å (—à—Ä–∏—Ñ—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ –≤—Å–µ—Ö —Å–∏—Å—Ç–µ–º–∞—Ö)

#### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `src/app/layout.tsx` ‚Äî —É–±—Ä–∞–Ω—ã Google Fonts
- `src/app/globals.css` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–∏—Å—Ç–µ–º–Ω—ã–µ —à—Ä–∏—Ñ—Ç—ã

---
*–û–±–Ω–æ–≤–ª–µ–Ω–æ: 2026-02-24*
