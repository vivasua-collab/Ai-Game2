/**
 * Общие константы игры
 * Единый источник констант для фронтенда и бэкенда
 */

// ==================== КОНСТАНТЫ ЦИ ====================

export const QI_CONSTANTS = {
  /** Секунд в сутках */
  SECONDS_PER_DAY: 86400,
  
  /** Кап пассивного накопления (90% от ёмкости) */
  PASSIVE_QI_CAP: 0.9,
  
  /** Базовая скорость генерации ядром (10% от ёмкости в сутки) */
  CORE_GENERATION_RATE: 0.1,
  
  /** Базовая плотность Ци (ед/м³) */
  DEFAULT_QI_DENSITY: 20,
  
  /** Множители проводимости по уровням культивации
   * Источник: cultivation-levels.ts conductivityMultiplier
   */
  CONDUCTIVITY_MULTIPLIERS: {
    1: 1,
    2: 1.2,
    3: 1.5,
    4: 2,
    5: 3,
    6: 5,
    7: 8,
    8: 15,
    9: 50,
    10: 100,
  } as Record<number, number>,
} as const;

// ==================== КОНСТАНТЫ ПРОРЫВА ====================

export const BREAKTHROUGH_CONSTANTS = {
  /** Множитель увеличения ёмкости ядра при прорыве */
  CORE_CAPACITY_MULTIPLIER: 1.1,
  
  /** Базовое количество заполнений на уровень */
  FILLS_PER_LEVEL: 10,
  
  /** Усталость при прорыве */
  FATIGUE: {
    /** Физическая усталость при любом прорыве */
    PHYSICAL_BASE: 10,
    /** Ментальная усталость при малом прорыве */
    MENTAL_MINOR: 25,
    /** Ментальная усталость при большом прорыве */
    MENTAL_MAJOR: 40,
  },
} as const;

// ==================== КОНСТАНТЫ МЕДИТАЦИИ ====================

export const MEDITATION_CONSTANTS = {
  /** Накопление ментальной усталости в минуту при концентрации (0.05% = 3% в час) */
  MENTAL_FATIGUE_RATE: 0.05,
  
  /** Множитель ментальной усталости при прорыве (больше концентрации) */
  MENTAL_FATIGUE_BREAKTHROUGH_MULTIPLIER: 2.0,
} as const;

// ==================== КОНСТАНТЫ УСТАЛОСТИ ====================

export const FATIGUE_CONSTANTS = {
  /** Максимальная усталость (%) */
  MAX_FATIGUE: 100,
  
  /** Минимальная усталость (%) */
  MIN_FATIGUE: 0,
  
  // === ВОССТАНОВЛЕНИЕ ВО СНЕ ===
  /** Физическое восстановление во сне (% в минуту) */
  SLEEP_PHYSICAL_RECOVERY: 0.208,  // ~100% за 8 часов (480 мин * 0.208 = 100%)
  
  /** Ментальное восстановление во сне (% в минуту) */
  SLEEP_MENTAL_RECOVERY: 0.208,   // ~100% за 8 часов (480 мин * 0.208 = 100%)
  
  // === ЛЁГКИЙ ОТДЫХ ===
  /** Физическое восстановление при лёгком отдыхе (% в минуту) */
  REST_LIGHT_PHYSICAL: 0.05,      // 3% в час
  
  /** Ментальное восстановление при лёгком отдыхе (% в минуту) */
  REST_LIGHT_MENTAL: 0.025,       // 1.5% в час
  
  // === ПАССИВНОЕ ВОССТАНОВЛЕНИЕ ===
  /** Пассивное физическое восстановление (% в час) */
  PASSIVE_PHYSICAL_RATE: 0.5,
  
  /** Пассивное ментальное восстановление (% в час) */
  PASSIVE_MENTAL_RATE: 0.3,
  
  // === КРИТИЧЕСКИЕ ПОРОГИ ===
  /** Порог высокой усталости (%) */
  HIGH_FATIGUE_THRESHOLD: 70,
  
  /** Порог критической усталости (%) */
  CRITICAL_FATIGUE_THRESHOLD: 90,
} as const;

/**
 * Множители восстановления усталости по уровню культивации
 * Практик 9-го уровня может не спать неделями!
 * 
 * Формула: baseRecovery * FATIGUE_RECOVERY_BY_LEVEL[level]
 */
export const FATIGUE_RECOVERY_BY_LEVEL: Record<number, number> = {
  1: 1.0,    // Базовый уровень
  2: 1.2,    // +20%
  3: 1.5,    // +50%
  4: 2.0,    // x2
  5: 3.0,    // x3
  6: 5.0,    // x5
  7: 10.0,   // x10
  8: 30.0,   // x30
  9: 100.0,  // x100 (полное восстановление за несколько минут!)
} as const;

/**
 * Множители НАКОПЛЕНИЯ усталости по уровню культивации
 * Чем выше уровень, тем медленнее накапливается усталость
 * 
 * Формула: fatigueGain * FATIGUE_ACCUMULATION_BY_LEVEL[level]
 */
export const FATIGUE_ACCUMULATION_BY_LEVEL: Record<number, number> = {
  1: 1.0,    // Базовый
  2: 0.9,    // -10%
  3: 0.8,    // -20%
  4: 0.6,    // -40%
  5: 0.4,    // -60%
  6: 0.2,    // -80%
  7: 0.1,    // -90%
  8: 0.05,   // -95%
  9: 0.01,   // Накапливает усталость в 100 раз медленнее!
} as const;

// ==================== НАЗВАНИЯ УРОВНЕЙ КУЛЬТИВАЦИИ ====================

export const CULTIVATION_LEVEL_NAMES = [
  '',                      // 0 - не используется
  'Пробуждённое Ядро',     // 1
  'Течение Жизни',         // 2
  'Пламя Внутреннего Огня', // 3
  'Объединение Тела и Духа', // 4
  'Сердце Небес',          // 5
  'Разрыв Пелены',         // 6
  'Вечное Кольцо',         // 7
  'Глас Небес',            // 8
  'Бессмертное Ядро',      // 9
  'Вознесение',            // 10
] as const;

// ==================== ТИПЫ МЕДИТАЦИИ ====================

export type MeditationType = 'accumulation' | 'breakthrough' | 'conductivity';

/**
 * Константы для типов медитации
 */
export const MEDITATION_TYPE_CONSTANTS = {
  /** Коэффициент экстрапроводимости за каждую медитацию на проводимость (в %) */
  CONDUCTIVITY_BONUS_PERCENT: 10,
  
  /** Максимальное количество медитаций на проводимость для уровня */
  MAX_CONDUCTIVITY_MEDITATIONS_BY_LEVEL: {
    1: 5,   // Уровень 1: максимум 5 медитаций = +50% проводимости
    2: 10,  // Уровень 2: максимум 10 медитаций = +100% проводимости
    3: 15,  // Уровень 3: максимум 15 медитаций = +150% проводимости
    4: 20,  // Уровень 4: максимум 20 медитаций = +200% проводимости
    5: 25,  // Уровень 5: максимум 25 медитаций = +250% проводимости
    6: 30,  // Уровень 6: максимум 30 медитаций = +300% проводимости
    7: 40,  // Уровень 7: максимум 40 медитаций = +400% проводимости
    8: 50,  // Уровень 8: максимум 50 медитаций = +500% проводимости
    9: 60,  // Уровень 9: максимум 60 медитаций = +600% проводимости
  } as Record<number, number>,
  
  /** Множитель ментальной усталости для медитации на проводимость */
  CONDUCTIVITY_MENTAL_FATIGUE_MULTIPLIER: 1.5,
  
  /** Множитель ментальной усталости для медитации на прорыв */
  BREAKTHROUGH_MENTAL_FATIGUE_MULTIPLIER: 2.0,
} as const;

// ==================== ТИПЫ ДЕЙСТВИЙ БОЯ ====================

export const COMBAT_ACTION_COSTS: Record<string, number> = {
  basic_strike: 5,
  qi_blast: 20,
  qi_shield: 15,
  enhanced_movement: 10,
} as const;

// ==================== ТИПЫ ДЕЙСТВИЙ КУЛЬТИВАЦИИ ====================

export const CULTIVATION_ACTION_COSTS: Record<string, number> = {
  basic_technique: 5,
  intermediate_technique: 15,
  advanced_technique: 30,
} as const;

// ==================== ТИПЫ ДЕЙСТВИЙ ВОССТАНОВЛЕНИЯ ====================

export const HEALING_ACTION_COSTS: Record<string, number> = {
  healing_minor: 10,
  healing_major: 50,
} as const;

// ==================== ВСЕ ЗАТРАТЫ ЦИ ====================

export const QI_COSTS = {
  ...COMBAT_ACTION_COSTS,
  ...CULTIVATION_ACTION_COSTS,
  ...HEALING_ACTION_COSTS,
  sensory_enhancement: 5,
  speed_boost: 20,
  strength_boost: 20,
} as const;

// ==================== СИСТЕМА ПРОЗРЕНИЯ ====================

/**
 * Аккумулятор Понимания Ци
 * Скрытый навык - не отображается в UI
 * При достижении cap → прозрение → новая техника
 */
export const QI_UNDERSTANDING_CAP: Record<number, number> = {
  1: 100,    // Уровень 1
  2: 200,    // Уровень 2
  3: 400,    // Уровень 3
  4: 800,    // Уровень 4
  5: 1600,   // С 5-го уровня доступно прозрение
  6: 3200,   // Уровень 6
  7: 6400,   // Уровень 7
  8: 12800,  // Уровень 8
  9: 25600,  // Уровень 9
} as const;

/**
 * Константы системы прозрения
 */
export const INSIGHT_CONSTANTS = {
  /** Минимальный уровень для разбора техник */
  MIN_LEVEL_FOR_ANALYSIS: 5,
  
  /** Минимальное мастерство техники для разбора */
  MIN_MASTERY_FOR_ANALYSIS: 50,
  
  /** Базовый прирост понимания за уровень техники (изучение) */
  BASE_QI_GAIN_PER_TECHNIQUE_LEVEL: 10,
  
  /** Множитель прироста при разборе техники */
  ANALYSIS_GAIN_MULTIPLIER: 2.5,  // level * 25 вместо level * 10
  
  /** Базовый шанс создания техники при разборе */
  BASE_INSIGHT_CHANCE: 0.1,  // 10%
  
  /** Бонус шанса от интеллекта (за единицу) */
  INSIGHT_CHANCE_PER_INTELLIGENCE: 0.01,
  
  /** Бонус шанса от проводимости (за единицу) */
  INSIGHT_CHANCE_PER_CONDUCTIVITY: 0.02,
  
  /** Бонус шанса от мастерства техники (за %) */
  INSIGHT_CHANCE_PER_MASTERY: 0.005,
} as const;

// ==================== СИСТЕМА ГЛОБАЛЬНОГО ВРЕМЕНИ ====================

/**
 * Константы системы тиков (глобального времени)
 * 
 * 1 тик = 1 минута игрового времени
 * Время течёт только при активных действиях
 */
export const TIME_CONSTANTS = {
  /** Длительность тика в миллисекундах (для UI отображения) */
  TICK_DURATION_MS: 100,  // 100ms = 1 минута игрового времени (ускоренное время)
  
  /** Минимальное время действия в тиках */
  MIN_ACTION_TICKS: 1,
  
  /** Минимальное время медитации в тиках (30 минут = 30 тиков) */
  MIN_MEDITATION_TICKS: 30,
  
  /** Максимальное время медитации в тиках (8 часов = 480 тиков) */
  MAX_MEDITATION_TICKS: 480,
  
  /** Дискретность медитации в тиках (30 минут) */
  MEDITATION_TICK_STEP: 30,
  
  /** Минут в часе */
  MINUTES_PER_HOUR: 60,
  
  /** Часов в сутках */
  HOURS_PER_DAY: 24,
  
  /** Минут в сутках */
  MINUTES_PER_DAY: 60 * 24, // 1440
} as const;

/**
 * Типы действий и их стоимость в тиках
 */
export const ACTION_TICK_COSTS: Record<string, number> = {
  // Движение
  move_tile: 1,          // Переход на одну клетку
  move_area: 5,          // Переход между зонами
  
  // Бой
  basic_attack: 1,       // Базовая атака
  combat_turn: 2,        // Ход в бою
  combat_round: 10,      // Раунд боя
  
  // Культивация
  meditation: 0,         // Определяется игроком (мин 30)
  breakthrough: 60,      // Прорыв = 1 час
  
  // Исследование
  examine: 1,            // Осмотреть объект
  search: 5,             // Поиск (5 минут)
  gather: 10,            // Сбор ресурсов
  
  // Социальное
  talk: 5,               // Разговор
  trade: 10,             // Торговля
  
  // Отдых
  rest: 0,               // Определяется игроком
  sleep: 0,              // Определяется игроком (мин 4 часа = 240 тиков)
} as const;

/**
 * Действия, которые НЕ тратят время (пауза времени)
 */
export const PAUSE_ACTIONS = [
  'view_inventory',
  'view_techniques',
  'view_skills',
  'view_status',
  'view_map',
  'open_menu',
  'pause',
] as const;
